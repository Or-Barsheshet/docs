---
title: "Old quick dataset analysis"
excerpt: "For future references"
hidden: true
metadata: 
  image: []
  robots: "index"
createdAt: "Tue Mar 21 2023 04:20:46 GMT+0000 (Coordinated Universal Time)"
updatedAt: "Thu Oct 26 2023 05:37:19 GMT+0000 (Coordinated Universal Time)"
---
# Visualize image clusters

Next, we will visualize the similarity clusters in the data, to find images that are similar to one another, and even exact duplicates. This is a useful first step in any analysis as it teaches us about the data distribution, and gives an early sense of how many similar images are there.

```python
fd.vis.component_gallery()
```

By default, the similarity cluster gallery is sorted by the cluster size (=number of similar images).

Our cluster gallery quickly reveals several clusters of similar images. Top cluster shows 4 images of the same dog, that are two pairs of duplicates.

The first images, representing the largest cluster, shows a group of Samoyed dogs in similar poses, and contains no exact duplicates. An example of tweaking thresholds for adjusting the similarity levels in clusters could be found in the [Cleaning and preparing a dataset](doc:abc) tutorial.

![](https://files.readme.io/1fd4c57-Screen_Shot_2023-02-26_at_18.17.45.png)

Now let's sort the cluster by their similarity, showing the closest ones first:

## Sorting by image similarity

> ðŸ“˜ Adjusting gallery image width
> 
> Depending on the size of the images in the dataset and your display settings, images may appear to small or too large. You can adjust that using the `max_width` parameter in the gallery, try a few pixel values to see what works best (e.g., `900`, `1200`)

```python
fd.vis.component_gallery(sort_by='distance',  ascending=False, max_width=900)
```

![](https://i.imgur.com/F4oSHEm.png)

It seems that many of the cat images in the data are either exact duplicates of one another, or very slight variations of the same image. We can see two images that are probably resized copies of one another, like these two Abyssinian cat images.

## Get a list of duplicate images

The `.connected_components()` method provides us with a mapping telling us to which similarity cluster each image belongs. We can filter it by the `mean_distance` value, only showing cluster that are above a certain similarity threshold.

```python
cc_df, _ = fd.connected_components()
cc_df[cc_df.mean_distance > 0.99]  # All clusters above 0.99 mean distance
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

```
.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
```

</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fastdup_id</th>
      <th>component_id</th>
      <th>sum</th>
      <th>count</th>
      <th>mean_distance</th>
      <th>min_distance</th>
      <th>max_distance</th>
      <th>img_filename</th>
      <th>error_code</th>
      <th>is_valid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>601</th>
      <td>602</td>
      <td>587</td>
      <td>4.0000</td>
      <td>4.0</td>
      <td>1.0000</td>
      <td>1.0000</td>
      <td>1.0000</td>
      <td>Bombay_100.jpg</td>
      <td>VALID</td>
      <td>True</td>
    </tr>
    <tr>
      <th>611</th>
      <td>612</td>
      <td>587</td>
      <td>4.0000</td>
      <td>4.0</td>
      <td>1.0000</td>
      <td>1.0000</td>
      <td>1.0000</td>
      <td>Bombay_11.jpg</td>
      <td>VALID</td>
      <td>True</td>
    </tr>
    <tr>
      <th>688</th>
      <td>689</td>
      <td>667</td>
      <td>1.0000</td>
      <td>1.0</td>
      <td>1.0000</td>
      <td>1.0000</td>
      <td>1.0000</td>
      <td>Bombay_185.jpg</td>
      <td>VALID</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>86 rows Ã— 10 columns</p>
</div>

### Grouping by similarity cluster

A simple grouping operation shows us each individual cluster and allows us to analyze the images that it contains. 

```python
agg_dict = {'img_filename': list, 'mean_distance': max}
duplicates_df = cc_df.groupby('component_id').agg(agg_dict).sort_values(by=['mean_distance'], ascending=False)
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

```
.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
```

</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>img_filename</th>
      <th>mean_distance</th>
    </tr>
    <tr>
      <th>component_id</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5171</th>
      <td>[newfoundland_137.jpg, newfoundland_153.jpg]</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>605</th>
      <td>[Bombay_118.jpg, Bombay_209.jpg]</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4599</th>
      <td>[keeshond_103.jpg, keeshond_167.jpg]</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4512</th>
      <td>[japanese_chin_188.jpg, japanese_chin_78.jpg]</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3564</th>
      <td>[english_cocker_spaniel_176.jpg, english_cocker_spaniel_179.jpg]</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>

# Visualize outlier images

Outliers are images that are the least similar to other images in the dataset. While outliers are usually case-dependent, this view can often uncover images that shouldn't belong to the data, or that are even corrupted or broken. Here we can see an image of two cats, as well as a cat in uncommon lighting conditions. Large watermarks could also register as outliers.

```python
fd.vis.outliers_gallery()
```

![](https://files.readme.io/ee15138-Screen_Shot_2023-02-26_at_18.31.22.png)

## Get a list of outliers

To fetch a list of outliers, sorted with the strongest outlier at the top, use the `.outliers()` method. It is as simple as:

```python
fd.outliers()
```

Each line lists and outlier image and its available metadata (class, split, dimensions, etc.), as well as its nearest neighbor image for reference.

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

```
.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
```

</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>outlier</th>
      <th>nearest</th>
      <th>distance</th>
      <th>img_filename_outlier</th>
      <th>error_code_outlier</th>
      <th>is_valid_outlier</th>
      <th>img_filename_nearest</th>
      <th>error_code_nearest</th>
      <th>is_valid_nearest</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>34</th>
      <td>207</td>
      <td>4127</td>
      <td>0.596920</td>
      <td>Bengal_105.jpg</td>
      <td>VALID</td>
      <td>True</td>
      <td>german_shorthaired_33.jpg</td>
      <td>VALID</td>
      <td>True</td>
    </tr>
    <tr>
      <th>39</th>
      <td>236</td>
      <td>1160</td>
      <td>0.611524</td>
      <td>Bengal_131.jpg</td>
      <td>VALID</td>
      <td>True</td>
      <td>Egyptian_Mau_6.jpg</td>
      <td>VALID</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>173</th>
      <td>1728</td>
      <td>4360</td>
      <td>0.754885</td>
      <td>Ragdoll_264.jpg</td>
      <td>VALID</td>
      <td>True</td>
      <td>great_pyrenees_63.jpg</td>
      <td>VALID</td>
      <td>True</td>
    </tr>
    <tr>
      <th>177</th>
      <td>1797</td>
      <td>1629</td>
      <td>0.754934</td>
      <td>Ragdoll_97.jpg</td>
      <td>VALID</td>
      <td>True</td>
      <td>Ragdoll_130.jpg</td>
      <td>VALID</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>454 rows Ã— 9 columns</p>
</div>

# Visualize blurry, dark and bright images

With fastdup it is easy to find challenging and possibly broken images by observing image statistics. Image statistics include brightness, blur, color standard-deviation and more. The `vis.stats_gallery`  method allows us to visualize images with the highest and lowest values for each image statistics. 

We can use it for selecting images for color correction, or for removal.

Below are example galleries showing the blurriest, darkest and brightest images.

```python python
fd.vis.stats_gallery(metric='blur')
```

![](https://files.readme.io/2e198e8-Screen_Shot_2023-02-27_at_12.47.21.png)

```python python
fd.vis.stats_gallery('dark')
```

![](https://files.readme.io/66d75c7-Screen_Shot_2023-02-27_at_12.48.23.png)

```python python
fd.vis.stats_gallery('bright')
```

![](https://files.readme.io/5b2ce62-Screen_Shot_2023-02-27_at_12.48.11.png)

## Getting the image statistics table - blurry, dark and bright

For further analysis and filtering, the table of image statistics could be obtained using `.img_stats` method. This gives us the raw table with all statistics for all images in our dataset.

```python
fd.img_stats()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

```
.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
```

</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fastdup_id</th>
      <th>img_filename</th>
      <th>img_w</th>
      <th>img_h</th>
      <th>unique</th>
      <th>blur</th>
      <th>mean</th>
      <th>min</th>
      <th>max</th>
      <th>stdv</th>
      <th>file_size</th>
      <th>contrast</th>
      <th>error_code</th>
      <th>is_valid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>Abyssinian_1.jpg</td>
      <td>600</td>
      <td>400</td>
      <td>239</td>
      <td>586.0380</td>
      <td>69.5999</td>
      <td>0.0</td>
      <td>242.0</td>
      <td>37.9883</td>
      <td>32362</td>
      <td>1.0</td>
      <td>VALID</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Abyssinian_10.jpg</td>
      <td>375</td>
      <td>500</td>
      <td>248</td>
      <td>808.7275</td>
      <td>69.1038</td>
      <td>0.0</td>
      <td>249.0</td>
      <td>52.6960</td>
      <td>96294</td>
      <td>1.0</td>
      <td>VALID</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>Abyssinian_100.jpg</td>
      <td>394</td>
      <td>500</td>
      <td>256</td>
      <td>4120.0146</td>
      <td>142.0682</td>
      <td>0.0</td>
      <td>255.0</td>
      <td>84.0555</td>
      <td>126923</td>
      <td>1.0</td>
      <td>VALID</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>Abyssinian_101.jpg</td>
      <td>450</td>
      <td>313</td>
      <td>256</td>
      <td>2440.4067</td>
      <td>128.6538</td>
      <td>0.0</td>
      <td>255.0</td>
      <td>78.9571</td>
      <td>49023</td>
      <td>1.0</td>
      <td>VALID</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>Abyssinian_102.jpg</td>
      <td>500</td>
      <td>465</td>
      <td>256</td>
      <td>4965.8892</td>
      <td>127.4869</td>
      <td>0.0</td>
      <td>255.0</td>
      <td>57.4010</td>
      <td>165505</td>
      <td>1.0</td>
      <td>VALID</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>
